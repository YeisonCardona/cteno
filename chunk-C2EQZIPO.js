import{a as ne}from"./chunk-KLNJ7MCT.js";import{a as Z,b as ee,c as te,d as ie,e as ae,f as re}from"./chunk-XK3WGNTX.js";import{k as Y}from"./chunk-MQXXVJ5G.js";import{b as Q,c as X}from"./chunk-5KUHHG2T.js";import"./chunk-O7Y5BQR5.js";import{a as K}from"./chunk-RWZ5KVH3.js";import"./chunk-QLT6AE7C.js";import"./chunk-NQY4IIVY.js";import"./chunk-LSDNS6DE.js";import{c as q}from"./chunk-6FCW6PRT.js";import"./chunk-ZLARDY7D.js";import"./chunk-ZEMTS2XM.js";import{a as z,b as N,f as W}from"./chunk-R2RV5J47.js";import"./chunk-DFATN2KX.js";import"./chunk-K4ZJ7WWT.js";import{a as L}from"./chunk-DFALDRPA.js";import{a as J}from"./chunk-R2XX3Z6S.js";import"./chunk-5G224GAC.js";import"./chunk-DLRADPMP.js";import{b as U}from"./chunk-STTCBUMV.js";import"./chunk-LW53S46Q.js";import{b as B}from"./chunk-63RWRTVN.js";import"./chunk-GKTD2TDN.js";import"./chunk-3VEW6XJI.js";import"./chunk-6DJDMNPN.js";import"./chunk-UX7NPTUT.js";import"./chunk-RBU5VOLW.js";import{a as O}from"./chunk-6JWNTJQL.js";import{h as G}from"./chunk-IZCHANQD.js";import{a as V,c as F}from"./chunk-K7KCRJWB.js";import{j as A,l as H,o as j}from"./chunk-7AW62Q5F.js";import{m as R}from"./chunk-5REQRI7Z.js";import"./chunk-YJICZ77K.js";import{Ic as x,Jb as S,Kb as w,Pb as p,Qb as s,Rb as o,Sb as u,Zb as k,ab as C,bb as T,bc as y,cc as _,db as r,mb as h,oa as f,pa as g,qc as c,rc as E,tb as D,tc as I,yb as P,yc as $}from"./chunk-TR6HYK2P.js";function se(a,b){if(a&1&&u(0,"app-diagram",8),a&2){let t=_();p("diagram",t.diagram)}}function le(a,b){if(a&1){let t=k();s(0,"mat-tab",19),u(1,"div",25),s(2,"app-markers",26),y("stimulusMarkersMapData",function(e){f(t);let n=_();return g(n.setStimulusMarkersMapData(e))})("stimulusMarkersMap",function(e){f(t);let n=_();return g(n.setStimulusMarkersMap(e))}),o()()}if(a&2){let t=_();r(2),p("stimulusCommandMap",t.stimulusCommandMap)}}function me(a,b){a&1&&u(0,"mat-tab",20)}function pe(a,b){if(a&1&&(s(0,"mat-tab",21),u(1,"app-layout-commands",27),o()),a&2){let t=_();r(),p("commandRegistryMap",t.commandRegistry)("stimulusCommandMap",t.stimulusCommandMap)("hardwareIP",t.hardwareService.hardwareIP())}}function ue(a,b){a&1&&u(0,"mat-tab",22)}function de(a,b){if(a&1&&(s(0,"mat-tab",23),u(1,"div",25)(2,"app-specification",28),o()),a&2){let t=_();r(2),p("stimulusMarkersMapData",t.stimulusMarkersMapData)("experimentConfig",t.formData)("stimuli_delivery_link",t.currentUrl+t.getFullWindowLink("/stimuli"))}}function ce(a,b){a&1&&u(0,"mat-tab",24)}var oe=class a extends re{constructor(t,i,e,n,l,m){super(t,i,e,n,l);this.breadcrumbService=m;this.breadcrumbService.setBreadcrumbs([{label:"Home",url:"/home"},{label:"Paradigms",url:"/paradigms"},{label:"P300",url:"/paradigms/p300"},{label:"Speller",url:"/paradigms/p300/speller"}])}requieredTier="Hobbyist";storageKey="speller-p300";resetValues(){return{flash_duration:125,target_duration:1e3,target_probability:10,repetitions_per_target:300,soa_inter_trial:200,soa_intra_trial:1e3,target_characters:15}}summary=x(()=>{let t=this.formData();if(!t||Object.keys(t).length===0)return"";let i=[],e=t.target_characters,n=t.soa_inter_trial,l=Math.round(((t.flash_duration+t.soa_inter_trial)*t.repetitions_per_target*e+t.target_duration*e+t.soa_intra_trial*e)/6e4);e>1e3&&i.push("The total number of trials exceeds 1000. This may lead to participant fatigue."),l>30&&i.push("Estimated experiment duration exceeds 30 minutes. Consider reducing trials or stimulus duration.");let m=i.length?`<p class="warning"><b>\u26A0\uFE0F Warnings:</b><br>${i.map(d=>`\u2022 ${d}`).join("<br>")}</p>`:"";return`
    <p class="summary-block">
      <b>Total trials</b>: ${e}<br>
      <b>Stimulus duration</b>: ${t.flash_duration} ms<br>
      <b>SOA</b>: ${n} ms<br>
      <b>Estimated duration</b>: ${l} min
    </p>
    ${m}
  `});ngOnInit(){this.experiment={name:"P300 Speller",description:"This experiment implements a matrix-based <b>P300 speller paradigm</b> in which rows and columns of a <b>character grid</b> flash in rapid succession. Participants focus on a specific letter or symbol within the matrix, and a <b>P300 response</b> is elicited when the row or column containing the target character is highlighted. This paradigm is widely used for <b>non-verbal communication</b> and <b>attention-based BCI systems</b>.",objective:"The objective of this experiment is to determine the feasibility of decoding <b>user intent</b> by detecting <b>P300 components</b> elicited during attention to specific characters. By analyzing the brain's response to row and column flashes, the system can identify the target character being attended, enabling <b>spelling without motor output</b>.",procedure:"Participants are seated in front of a grid (e.g., <b>6\xD76 matrix</b>) containing letters, numbers, or symbols. Each trial consists of a rapid sequence of <b>row and column flashes</b>, presented in random order. The participant focuses on a specific character, and silently counts or attends each time its <b>row or column</b> is illuminated. Stimuli are presented for brief durations (typically <b>100\u2013200 ms</b> per flash), with short inter-stimulus intervals. The EEG signal is continuously recorded and analyzed to detect <b>P300 responses</b> corresponding to the target row and column. A session may include <b>multiple target selections</b> and typically lasts <b>20\u201330 minutes</b>."},this.stimulusCommandMap={A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",_:"_",Target:"*t",NonTarget:"*n",Feedback:"*f"},this.formField=[{type:"slider",key:"flash_duration",label:"Flash Duration",value:125,min:10,max:1e3,step:1,suffix:"ms",hint:"Duration of each flash stimulus"},{type:"slider",key:"target_duration",label:"Target Duration",value:1e3,min:500,max:2e3,step:1,suffix:"ms",hint:"How long each target character is displayed"},{type:"slider",key:"target_probability",label:"Target",value:10,min:1,max:100,step:1,suffix:"%",hint:"Percentage of trials that will show the target stimulus."},{type:"slider",key:"repetitions_per_target",label:"Repetitions per Target",value:300,min:1,max:1e3,step:1,suffix:"times",hint:"Number of times each target is flashed during selection."},{type:"slider",key:"soa_inter_trial",label:"Inter-Trial SOA (ms)",value:200,min:0,max:1e3,step:1,suffix:"ms",hint:"Delay between the onset of consecutive stimuli (i.e., between trials)"},{type:"slider",key:"soa_intra_trial",label:"Intra-Trial SOA (ms)",value:1e3,min:100,max:2e3,step:10,suffix:"ms",hint:"Delay between consecutive flashes within a single trial"},{type:"slider",key:"target_characters",label:"Target Characters",value:15,min:1,max:50,step:1,suffix:"chars",hint:"Number of distinct letters to be spelled during the experiment."}]}diagram=x(()=>{let i=this.formData();if(Object.keys(i).length===0)return{height:"0",blocks:[]};let e=i.target_duration+i.flash_duration*5+i.soa_inter_trial*5+i.soa_intra_trial,n=i.target_duration/e*100,l=i.flash_duration/e*100,m=i.soa_inter_trial/e*100,d=i.soa_intra_trial/e*100,v=[{name:"soa",label:`Stimulus Onset Asynchonously<br>Randomized Delay: ${i.soa_intra_trial} ms`,width:`${d}%`},{name:"cue2",label:`Target Presentation<br>Duration: ${i.target_duration} ms`,left:`${d}%`,width:`${n}%`},{name:"marker",label:"Marker Encoding<br>(Synchronization Trigger)",bottom:"205px",left:`${d}%`,width:`${n}%`,height:"50px"}];for(let M=0;M<5;M++)v.push({name:"cue",label:"Column or Row Activation",left:`${d+n+(m+l)*M}%`,width:`${l}%`,vertical:!0}),v.push({name:"soa",label:"Inter-Stimulus Asynchrony",left:`${d+n+l+(m+l)*M}%`,width:`${m}%`,vertical:!0}),v.push({name:"marker",label:"Marker",bottom:"205px",left:`${d+n+(m+l)*M}%`,width:`${l+m}%`,height:"50px"});return v.push(),{height:"250px",blocks:v.flat(),context:`A target character is presented for <b>${i.target_duration} ms</b>, followed by a sequence of <b>row and column
      flashes</b> (${i.flash_duration} ms). An <b>inter-trial SOA</b> of <b>${i.soa_inter_trial} ms</b> separates each row/column flash.
      After <b>${i.repetitions_per_target} flashes</b>, a <b>${i.soa_intra_trial} ms</b> pause occurs before the next character. Digital markers synchronize flashes
      with EEG/BCI recordings.`}});static \u0275fac=function(i){return new(i||a)(h(V),h(F),h(U),h(q),h(J),h(L))};static \u0275cmp=D({type:a,selectors:[["app-p300-speller"]],features:[P],decls:43,vars:25,consts:[["taskPanel",""],["tabGroup",""],["preFormComponent",""],["formComponent",""],[1,"app-container","container-spacer"],[1,"no-margin-bottom"],[1,"align-justify",3,"innerHTML"],[1,"grid-responsive-2"],[3,"diagram"],["dynamicHeight","","mat-stretch-tabs","","animationDuration","100ms",1,"example-stretched-tabs","mat-elevation-z4"],["label","Stimuli Delivery"],[1,"margin-bottom-small"],[3,"valueChange","config","columns","storageKey"],[1,"margin-top-large",3,"innerHTML"],[1,"flex-row","flex-row-left"],[1,"elipsis-96",3,"href"],["matIconButton","",3,"cdkCopyToClipboard"],["matButton","filled",1,"margin-top-large","margin-bottom-large",3,"click"],[3,"commandRegistry","formData","embedded","stimulusCommandMap","stimulusMarkersMap"],["label","Markers Generation"],["label","Markers Generation","disabled",""],["label","Neurofeedback & Runtime Events"],["label","Neurofeedback & Runtime Events","disabled",""],["label","Specification"],["label","Specification","disabled",""],[1,"margin-top-large"],[3,"stimulusMarkersMapData","stimulusMarkersMap","stimulusCommandMap"],[3,"commandRegistryMap","stimulusCommandMap","hardwareIP"],[3,"stimulusMarkersMapData","experimentConfig","stimuli_delivery_link"]],template:function(i,e){if(i&1){let n=k();s(0,"div",4,0)(2,"h1",5),c(3),o(),u(4,"p",6),s(5,"div",7)(6,"div")(7,"h2",5),c(8,"Objective"),o(),u(9,"p",6),o(),s(10,"div")(11,"h2",5),c(12,"Procedure"),o(),u(13,"p",6),o()(),S(14,se,1,1,"app-diagram",8),u(15,"mat-divider"),s(16,"mat-tab-group",9,1)(18,"mat-tab",10),u(19,"div",11),s(20,"app-inputs",12,2),y("valueChange",function(m){return f(n),g(e.onPreFormValueChange(m))}),o(),s(22,"app-inputs",12,3),y("valueChange",function(m){return f(n),g(e.onFormValueChange(m))}),o(),u(24,"div",13),s(25,"p",14)(26,"span")(27,"b"),c(28,"Direct experiment link:"),o()(),s(29,"a",15),c(30),o(),s(31,"button",16)(32,"mat-icon"),c(33,"content_copy"),o()()(),s(34,"button",17),y("click",function(){return f(n),g(e.loadDefaultValues())}),c(35,"Load Default Values"),o(),s(36,"app-stimuli",18),y("commandRegistry",function(m){return f(n),g(e.setCommandRegistry(m))}),o()(),S(37,le,3,1,"mat-tab",19)(38,me,1,0,"mat-tab",20),S(39,pe,2,3,"mat-tab",21)(40,ue,1,0,"mat-tab",22),S(41,de,3,3,"mat-tab",23)(42,ce,1,0,"mat-tab",24),o()()}i&2&&(r(3),E(e.experiment.name),r(),p("innerHTML",e.experiment.description,C),r(5),p("innerHTML",e.experiment.objective,C),r(4),p("innerHTML",e.experiment.procedure,C),r(),w(e.diagram()?14:-1),r(6),p("config",e.preFormField)("columns",e.columns)("storageKey","nomatters-"+e.storageKey),r(2),p("config",e.formField)("columns",e.columns)("storageKey",e.storageKey),r(2),p("innerHTML",e.summary(),C),r(5),p("href",$("",e.currentUrl,"",e.getFullWindowLink("/stimuli")),T),r(),I(" ",e.currentUrl,"",e.getFullWindowLink("/stimuli")," "),r(),p("cdkCopyToClipboard",e.currentUrl+e.getFullWindowLink("/stimuli")),r(5),p("formData",e.formData)("embedded","embedded")("stimulusCommandMap",e.stimulusCommandMap)("stimulusMarkersMap",e.stimulusMarkersMap),r(),w(e.showMarkersGeneration?37:38),r(2),w(e.showNeurofeedbackEvents?39:40),r(2),w(e.showSpecification?41:42))},dependencies:[ne,R,W,z,N,B,Z,j,H,A,X,Q,Y,ee,G,K,O,ie,te,ae],encapsulation:2})};export{oe as P300Speller};
