import{c as P}from"./chunk-NQY4IIVY.js";import{a as k,b as O,c as L,d as D}from"./chunk-ZXYXH6UO.js";import{k as F}from"./chunk-6FCW6PRT.js";import{c as I}from"./chunk-63RWRTVN.js";import{b as E}from"./chunk-GKTD2TDN.js";import{Ba as f,Ga as d,Ib as C,Lb as y,Nb as b,Ob as x,Pb as M,Qb as l,Rb as m,cc as _,db as o,g as p,h as u,i as g,oc as T,qc as w,rc as S,tb as h,yb as v}from"./chunk-TR6HYK2P.js";function j(c,e){if(c&1&&(l(0,"span",3,0),w(2),m()),c&2){let i=e.$implicit,t=_();T("visible",t.showIcon()[i.class]),C("cue-key",t.fixClass(i.class)),o(2),S(i.value)}}var n=class n extends L{showIcon=f(Object.fromEntries(this.cues().map(e=>[e.class,!1])));fullWindowLink="/paradigms/p300/rsvp-speller/stimuli";normalWindowLink="/paradigms/p300/rsvp-speller";startCountdownValue=0;generateCuesOnFormUpdate=!0;allowModes=["sequential"];ngOnInit(){return g(this,null,function*(){u(n.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE TEXT="RSVP Speller" COLOR=BLUE SIZE=3;')})}generateCues(){this.cues.set(Object.keys(this.stimulusCommandMap).filter(e=>!this.stimulusCommandMap[e].startsWith("*")).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]})))}generateTrials(){let e=[];for(let i=0;i<this.experimentConfig.target_characters;i++){let t=this.experimentConfig.categories;console.log(t);let s=t[0];t=t.slice(1),e.push({class:s+"-Feedback",duration:this.experimentConfig.target_duration,soa:this.experimentConfig.soa_inter_trial});let r=[],B=Math.floor(this.experimentConfig.target_probability*this.experimentConfig.repetitions_per_target/100);for(let a=0;a<B;a++)r.push({class:s+"-Target",duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial});for(let a=r.length;a<this.experimentConfig.repetitions_per_target;a++)r.push({class:this.getRandomItems(t,1)+"-NonTarget",duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial});r=this.shufflePreservingParity(r),r[r.length-1].soa=this.experimentConfig.soa_intra_trial,e.push(...r)}return e.flat()}showTrial(e){if(console.log(e),e===null){this.showIcon.set(Object.fromEntries(this.cues().map(s=>[s.class,s.class===e])));return}e.includes("-")||(e=e+"-Feedback");let[i,t]=e.split("-");if(this.propagateClassMarker(t.trim()),t==="Feedback"){let s=this.cuesSpanElement.find(r=>r.nativeElement.getAttribute("cue-key")===this.fixClass(i));s&&(s.nativeElement.style.color="var(--mat-sys-error)",setTimeout(()=>{s.nativeElement.style.color="var(--mat-sys-primary)"},this.experimentConfig.target_duration+50))}this.showIcon.set(Object.fromEntries(this.cues().map(s=>[s.class,s.class===i])))}stopStimuliSequence(){this.showTrial(null)}static \u0275fac=(()=>{let e;return function(t){return(e||(e=d(n)))(t||n)}})();static \u0275cmp=h({type:n,selectors:[["app-stimuli"]],features:[v],decls:3,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(l(0,"app-stimuli-layout",1),b(1,j,3,4,"span",2,y),m()),i&2&&(M("hostRef",t),o(),x(t.cues()))},dependencies:[I,k,E,P,F,D],styles:['.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-size:10vh;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:opacity .1s ease,visibility .1s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible}']})};p([O("TRIAL",{arguments:["CLASS"],example:"Trial Target",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],n.prototype,"showTrial",1);var R=n;export{R as a};
